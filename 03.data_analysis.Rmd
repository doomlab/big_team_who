---
title: "Data Analysis"
author: "Erin M. Buchanan"
date: "Last Knitted: `r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Libraries

```{r}
library(dplyr)
library(bib2df)
library(rio)
library(tidyr)

#### fix sau chins paper ####
```

## Import Bib Data

In this section, we are importing the bibtex file that includes all the papers we are going to use. 

Notes:

  - We used the preprint manuscript for some papers because they had the entire author list, we will update their references manually for the final dataset. 
  - We will have to manually add the names for several papers that used consortium authors. 
  - The pre-reg of this document only examines a few authors/papers to ensure code can be run and develop workflow. 

```{r}
bibs <- bib2df("papers.bib")

# get data into long format
long_bib <- bibs %>% unnest_longer(col = AUTHOR)

# remove this nonsense
long_bib$AUTHOR <- gsub("[{}]", "", long_bib$AUTHOR)

# now split the names into last, first middle 
# first split on the comma only 
long_bib <- long_bib %>% separate(col = AUTHOR, sep = ",", 
                                  into = c("last", "first"), 
                                  extra = "merge")

# remove the first space
long_bib$first <- gsub("^ ", "", long_bib$first)

# then split on space
long_bib <- long_bib %>% separate(col = first, sep = " ", 
                                  into = c("first", "middle"),
                                  extra = "merge")

# drop editor column so it is a non-nested DF
long_bib <- long_bib %>% select(-EDITOR)
```

In this section, we will add the information for authors when they used a consortium authorship. 

```{r}

```

## Import Author Data

```{r}
id_list <- import("test_utf8.xlsx")

o_works <- import("ORCID_works.csv")
o_ed <- import("ORCID_ed.csv")
o_job <- import("ORCID_job.csv")

s_works <- import("scholar_works.csv") 
s_info <- import("scholar_info.csv")
```

## Summary Statistics 

```{r}
o_works$publication_date_year_value[o_works$publication_date_year_value < 1920] <- NA

table(o_works$type)

# combine types ####see issues here #### 
# works_df$our_type <- works_df$type
# works_df$our_type <- gsub("other|data-set|preprint", "open_science_pubs", works_df$our_type)

o_works_summary <- o_works %>% 
  group_by(ORCID) %>% 
  summarize(o_career_1_pub = 2022 - min(publication_date_year_value, na.rm = T),
            o_total_pub = n())

s_works_summary <- s_works %>% 
  group_by(scholar) %>% 
  summarize(s_career_1_pub = 2022 - min(year, na.rm = T),
            s_total_pub = n())
####citations??####

####see issues here####
o_ed_summary <- o_ed %>% 
  group_by(ORCID) %>% 
  summarize(o_career_1_degree = 2022 - min(education_summary_end_date_year_value, na.rm = T)) 

# create a table that's ORCID, job, education, year for each year within bib 2013 to 2022

  
```

## Merge Information Back 

```{r}
merged_df <- long_bib %>% 
  left_join(
    (id_list %>% select(first, last, ORCID, scholar)), 
    by = c("first" = "first", "last" = "last")
  ) %>% 
  left_join(
    o_works_summary, 
    by = c("ORCID" = "ORCID")
  ) %>% 
  left_join(
    s_works_summary,
    by = c("scholar" = "scholar")
  ) %>% 
  left_join(
    o_ed_summary,
    by = c("ORCID" = "ORCID")
  ) %>% 
  left_join(
    (s_info %>% select(scholar, h_index, i10_index)),
    by = c("scholar" = "scholar")
  )

```

## Journal Information 

```{r}
table(bibs$JOURNAL)
table(bibs$KEYWORDS)


```

## Over Time 


Person statistics: 
- Career length: from first pub, from first degree
  `publication_date_year_value` anything 
- Employment levels
- Education levels
- # Of works: separate to total, other/preprint/data-set, journal/book/traditional
- Limitations of this system
...average citation rates/h index/i10 index 

Journal statistics: 
- Which journals are publishing this information
  - make sure preprints we are using also have real journal merged in 
- Types of big team research (social, cognitive)
  - keywords 
- Over time: are things becoming more varied
  - are the publications more varied over time 

