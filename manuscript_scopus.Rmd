---
title             : "Who does big team science?"
shorttitle        : "Big Team Science"
author: 
  - name          : "Erin M. Buchanan"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "326 Market St., Harrisburg, PA 17101"
    email         : "ebuchanan@harrisburgu.edu"
    role:         # Contributorship roles (e.g., CRediT, https://casrai.org/credit/)
      - Conceptualization
      - Data curation
      - Formal Analysis
      - Methodology
      - Project administration
      - Visualization
      - Writing – original draft
      - Writing – review & editing
  - name          : "Savannah C. Lewis"
    affiliation   : "2"
    role:
      - Conceptualization
      - Data curation
      - Methodology
      - Project administration
      - Writing – original draft
      - Writing – review & editing
affiliation:
    
  - id            : "1"
    institution   : "Harrisburg University of Science and Technology"
  - id            : "2"
    institution   : "University of Alabama"
authornote: |
  Erin M. Buchanan is a Professor of Cognitive Analytics at Harrisburg University of Science and Technology. Savannah C. Lewis is a graduate student at the University of Alabama.  
  
  Thank you to Dwayne Lieck for providing an extensive list of large scale projects for this manuscript. 
abstract: |
  This paper will examine the nature of publications in Big Team Science (BTS) - large-scale collaborations between multiple researchers at multiple institutions. As interest in BTS increases, it is useful to explore who is currently involved in BTS projects to determine diversity in both research subject and researcher representation. The types of publication outlets, number of publications, and subject areas of publication will be presented to summarize the publications in BTS. Information about authors included in BTS will be presented including career length, numbers of publications/impact variables, education, and affiliation. Last, we will explore the representation of geopolitical regions by examining affiliation location to explore the impact of BTS on the de-WEIRD movement to diversify researcher representation. 
  
keywords          : "big team, science, authorship, credit"
wordcount         : "X"
floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no
classoption       : "man"
editor_options: 
  markdown: 
    wrap: 72
bibliography: references.bib

header-includes:
  - |
    \makeatletter
    \renewcommand{\paragraph}{\@startsection{paragraph}{4}{\parindent}%
      {0\baselineskip \@plus 0.2ex \@minus 0.2ex}%
      {-1em}%
      {\normalfont\normalsize\bfseries\typesectitle}}
    
    \renewcommand{\subparagraph}[1]{\@startsection{subparagraph}{5}{1em}%
      {0\baselineskip \@plus 0.2ex \@minus 0.2ex}%
      {-\z@\relax}%
      {\normalfont\normalsize\bfseries\itshape\hspace{\parindent}{#1}\textit{\addperi}}{\relax}}
    \makeatother

csl               : "`r system.file('rmd', 'apa7.csl', package = 'papaja')`"
documentclass     : "apa7"
output            : papaja::apa6_docx
---

```{r setup, include = FALSE}
#knitr::opts_knit(echo = TRUE)
library(papaja)
library(knitr)
library(ggplot2)
library(treemapify)
library(countrycode)
library(rio)
library(maps)
library(dplyr)
library(tidyr)
library(MOTE)
library(MBESS)
library(patchwork)
```

```{r data, include = FALSE}
# things to import
var_list <- c("author_time", "career_time", "geo_country", "inst_time", 
              "keywords", "large_first_gp", "large_other_gp", "medium_first_gp", 
              "medium_other_gp", "normal_pub_type", "pub_time_count", 
              "pub_time_subject", "pub_types", "small_first_gp", "small_other_gp")

var_list_import <- paste0("py_outputs/", var_list, ".xlsx")

DF <- lapply(var_list_import, import)
names(DF) <- var_list
```


According to the Oxford English dictionary, collaboration is two or more
people working together to achieve a certain goal [@oed2016].
Collaboration in scientific endeavors involves multiple researchers at
(potentially) multiple institutions to communicate and work together to
advance knowledge in their chosen field. Collaboration can manifest
uniquely in each project dependent on the skill sets, hypotheses, and
perspectives of collaborators. While collaboration is not new in
science, the current interest of "big team science" is increasing
[@forscher2020; @stewart2017; @coles2022]. Big team science projects
and/or organizations utilize and run on large-scale collaboration to
ensure that diverse populations and ideas are brought into research
projects, which in turn allows for more reliability and generalizability
in the results and method of the study. For this study, Big Team Science
(BTS) will be defined as a collaboration of ten or more authors from at
least ten different institutions.

BTS appears to be increasing as a result of two sources: 1) increasing
globalization and technology that allows for real-time interdisciplinary
research, and 2) increasing interest in reproducibility, replication,
and generalizability [@maxwell2015; @nelson2018; @zwaan2018].
Technological advances have provided easier ways to collaborate with
people who are from other universities and countries through document
sharing platforms (e.g., Google, GitHub, and the Open Science
Framework), video chatting platforms (e.g., Zoom, Microsoft Teams), and
messaging and project management platforms (e.g., Slack, Trello,
when2meet, etc.). The credibility movement seems to suggest that by
having both collaborations that span across the globe and subfield of
psychology, age groups, and education levels should help to drive
psychological science in the path of better materials, reliability,
generalizability and more robust sample size in a study
[@auspurg2021has; @nosek2014method; @lebel2018].

The credibility movement was originally defined by a focus on large
scale replications using in collaborative environments [@vazire2022].
Generally, the movement has been driven by early career researchers
(i.e., those who are within five years of their first appointment)
[@maizey2019]; however, there are no large meta-scientific
investigations on this specific topic to date. Potentially, the lack of
investigation is tied to the newness of the large-scale research in many
fields, as it is only in recent years that publications like the Open
Science Collaboration [@opensciencecollaboration2015], Many Labs
Collaborations [for example, @klein2018; @ebersole2020; @ebersole2016;
@klein2022; @mathur2020; @buttrick2020; @skorb2020] or the first papers
from the Psychological Science Accelerator [@moshontz2018; @jones2021;
@dorison2022; @wang2021; @legate2022; @bago2022]. Generally, the
researcher incentive for replication was low: journals often prioritize
"novel" or new results which led to rejection of replication manuscripts
and publication bias [@hubbard1997; @franco2014; @nosek2012], the
"failure" to replicate was often placed on the replication team as "bad
science" rather than a careful consideration of publication biases and
(potential) questionable research practices [@ioannidis2015;
@maxwell2015; @klein2022], and why should someone want to spend time and
resources on an answer we already "know" [@isager2021; @isager2021a]?

However, the success and interest in the large-scale reproducibility
projects [@opensciencecollaboration2015; @10.7554/eLife.71601], paired
with the meta-scientific publications focusing on researcher practices
and incentive structures [@silberzahn2018many; @john2012] led to a
change in journal guidelines and incentives for researchers interested
in participating in large-scale replication studies [@grahe2014;
@kidwell2016; @nosek2015; @mayo-wilson2021]. For example, the support
for Registered Reports, papers accepted before the data has been
collected [@nosek2014; @stewart2020], and entire sub-sections of
journals devoted to only replication studies (e.g., *Nature, Royal
Society Open Science, Advances in Methods and Practices in Psychological
Science*) has allowed researchers to invest in projects that they know
should be published when the project is complete. Further, the
implementation of the Transparency and Openness Guidelines [@nosek2015]
and the Contributor Role Taxonomy (CRediT) system [@allen2019] have
pushed journals and researchers to promote more open, inclusive
publication practices.

The credibility movement has been mirrored by the calls for
diversification or de-WEIRDing (e.g., Western, Educated, Industrialized,
Rich, and Democratic) scientific research [@henrich2010; @newson2021;
@rad2018] by improving representation in research samples. Like the
large-scale studies in Physics [@aphilos2021; @castelnovo2018] and
Biology [@collins2003], the social sciences struggle to represent the
breadth of humanity across both researcher and population
characteristics. Now, grassroots organizations, such as the
Psychological Science Accelerator [@moshontz2018], ManyBabies
(<https://manybabies.github.io/>), NutNet (<https://nutnet.org/>), and
DRAGNet (<https://dragnetglobal.weebly.com/>) can begin to tackle these
issues by recruiting research labs from all over the globe to provide
diversity in geographic, linguistic, and researcher representation.
Publications have examined the global understanding of morality, face
processing, COVID-19 information signaling, and more [@dorison2022;
@wang2021; @legate2022; @bago2022; @jones2021; @vanbavel2022]. While
these organizations and one-time groups for BTS studies have provided an
incredible wealth of data for the scientific community, we do not yet
know exactly *who* is involved with, and benefits from, the BTS and
credibility movement. Publications on BTS generally explore challenges,
lessons learned, and the need for BTS [@forscher2020; @coles2022].

Therefore, the goal of this manuscript is to examine the *people*
involved in BTS projects. We specifically expect to examine ICSR's
Research Themes of inclusivity, research careers, and research
globalization. As we examine these themes, it will bring new knowledge
of how BTS projects impact each theme and field of study. We see an
increase in interest and publications in BTS but we do not yet know if
this uptick in large-scale projects has diversified the *people*
involved in BTS. While a few publications have noted that BTS appears to
be early career researchers [@maizey2019], no one has systematically
investigated this perception. Further, it is unclear if the focus of
de-WEIRDing science has only focused on the representation of the
research participants or if it has also improved the representation of
researchers outside of North America and Europe. Last, who runs these
BTS projects? Do we see an increase in diversity for the authors who
generally receive the most credit for these projects (i.e., first
several author(s) and last author)? As hiring and promoting practices
often place a heavy weight on publications and especially "influential"
publications, it becomes necessary to critically examine the
representation present in authorship in BTS projects.

# Potential Outlets

We will aim for high impact broad scope journals such as *Science*,
*Nature* or *Nature Human Behaviour*. Other journals would include
review publications within psychology to compare the social sciences to
other sciences: *Perspectives in Psychological Science*, *Psychological
Bulletin*, *Psychological Review*, or *Current Directions in
Psychological Science*.

# Research Questions

-   Research Question 1: What publication sources publish big team
    science papers?
-   Research Question 2: What are the types of articles that are being
    published in big team science?
-   Research Question 3: Who is involved in big team science?

For each of these research questions, we will examine the overall
results of all big team research projects, and examine for change in
result trends across years of publication. Below we detail our methods
and the ICSR/Scopus data to answer these questions, along with examples
of the statistical results we expect to report in the manuscript. We
began this project with data using Google Scholar and ORCID information.
These sources were severely limited in their scope and breadth, as they
are often curated with automatic processes or self-entered data, and we
believe that access to Scopus and ICSR would allow us to accurately
portray the BTS movement and its impact on diversity across many fields.
The novelty of this project is that it would focus on all of published
works, rather than a specific subfield (like Psychology) and give a lens
into global representation in science that would otherwise not be
achieved with open-source databases.

# Method

## Publications

We have defined **BTS publications** as publications with at least 10
authors at 10 different institutions that were published in
peer-reviewed journals or had posted a full paper pre-print. We will use
data from 1970 and forward in the publications (`ani`) database, as it
is noted online that this time period includes cited references for
calculation of several of our variables described below. We will analyze
our results based on the big four subject areas: Physical Sciences,
Health Sciences, Social Sciences, and Life Sciences.

## Data Curation

### RQ1: Publisher Information.

Using these criteria, we will extract the following information for
publication sources: the name of the publication (source title), subject
area (both the large four subject areas and the smaller four digit all
science journal classification ASJC codes). We will examine journal
impact using the Source Normalized Impact per Paper from the journal
(`sources`) database.

### RQ2: Publication Information.

For each publication of the identified BTS publications, we will analyze
the full four digit ASJC subject areas codes for each of the larger four
subject areas and the keywords present for these publications.

### RQ3: Author Information.

The author list will then be extracted from each publication. Next, we
will use the author (`au`) and affiliation (`af`) array to curate a list
of all publications and author information included in BTS papers. We
will use these two arrays with the publication array to calculate the
variables described below.

***Career Length***. Career length for each author will be defined as
the year of the first publication listed for each author.

***Institution***. We will use the affiliation ids and country to gather
information about the places of education and/or employment for authors.
Country will likely be binned into United Nation Sub-Region for
analyses.

***Education***. We will also collect degree information from the author
table.

***Types of Publications***. We will gather information from the
publication type variable for each author publication to present
information about the types of papers BTS authors publish.

***Publication Metrics***. For each author, we will calculate the total
number of publications, the h-index, and the i-10 index. The h-index
represents the highest *h* number of publications that have at least *h*
citations, while the i-10 index represents the number of publications
with at least 10 citations.

## Data analysis

### RQ1: Publisher Information.

To present results on this research question, we will analyze:

-   Number of articles for inclusion: total, separated by four subject
    areas, presenting graphics of the number of publication across time
    
total

13581

+----------------+-----+
|publication_type|count|
+----------------+-----+
|              sh|   41|
|              cp|  266|
|              ar|12689|
|              dp|    4|
|              pp|  580|
|              ip|    1|
+----------------+-----+

subject area 
+-----------------+-----+
|      SubjectArea|count|
+-----------------+-----+
|  Health Sciences|10685|
|Physical Sciences| 6151|
|Multidisciplinary| 1569|
|  Social Sciences|  543|
|    Life Sciences| 7686|
+-----------------+-----+

time

pub_time_count
    
-   Number of distinct journals within each of the four subject areas

Out[52]: 2534

+-----------------+------------+
|      SubjectArea|count(srcid)|
+-----------------+------------+
|  Health Sciences|        1472|
|Physical Sciences|         641|
|Multidisciplinary|          14|
|  Social Sciences|         206|
|    Life Sciences|        1024|
+-----------------+------------+

-   Statistics (mean, median, standard deviation, minimum, maximum) of
    the journal impact using Source Normalized Impact per Paper for the
    four subject areas.

+-----------------+------------------+------------------+---------+------------+---------+
|      SubjectArea|         avg(snip)| stddev_samp(snip)|min(snip)|median(snip)|max(snip)|
+-----------------+------------------+------------------+---------+------------+---------+
|  Health Sciences|  4.39848449724717|7.1846479513521615|      0.0|       2.078|  173.932|
|Physical Sciences|1.7298434289762685| 1.336672368345959|    0.155|       1.278|   30.405|
|Multidisciplinary| 6.092944123314063|   4.3151334953509|    0.032|       3.341|   11.342|
|  Social Sciences| 2.204784860557769|2.1441319264666743|    0.017|       1.605|   30.405|
|    Life Sciences| 2.524247249015079| 2.044898988084329|    0.017|       1.742|   12.624|
+-----------------+------------------+------------------+---------+------------+---------+

### RQ2: Publication Information.

For each publication, we will examine:

-   The totals of the number of articles published within the smaller
    subject area classifications. We will visualize these differences
    over time to determine if there is increasing interest in a specific
    subarea over time for each of the four larger subject area
    classifications.
    
pub_time_subject
    
-   The keywords present in the publications data overall to identify
    trends and common themes in the publications for the four subject
    areas using visualizations (wordclouds) to depict the common
    keywords.
    
keywords 

### RQ3: Authors.

We will first present:

-   The total number of unique authors

+-----------+
|count(auid)|
+-----------+
|     257536|
+-----------+

-   Statistics (mean, standard deviation, minimum, maximum, median) on
    the number of authors included on publications.
    
	count(Authorseq)	avg(Authorseq)	stddev_samp(Authorseq)	min(Authorseq)	median(Authorseq)	max(Authorseq)
0	13581	49.904646	207.006114	10	19.0	5155

-   We will present visualizations of these results across time.

author_time 

We will use $\alpha$ \< .05 for all analyses that involve hypothesis
testing. We make no directional predictions.

***Career Length***.

-   We will create a visualization of the trend and variance of
    researcher career length across publication years.
    
career_time 

-   To analyze trends over time, we will calculate the average career
    length for each publication (i.e., average the author career length
    to create one score for each paper) and run a regression analysis
    using career length to predict year of publication. A positive slope
    for year of publication would indicate increasing years of first
    publication (i.e., more younger scholars over time), while a
    negative slope would indicate older years of first publication
    (i.e., more older scholars over time).
-   In order to show variance between individuals, we calculate the
    standard deviation of career length for each publication and run a
    regression analysis using this variance representation to predict
    publication year. A positive slope would indicate increasing
    variance over time (i.e., more diversity in the career lengths of
    scholars), while a negative slope would indicate less variance and
    diversity in scholars over time.
-   These analyses will be completed separately for each of the four
    large subject areas.
    
------ Physical Sciences ------

Note: the last rows are the information for Intercept
## -------------------------------------------------
##   Estimate   |   Std.Error | t Values  |  P-value
##  -0.531373   0.030990  -17.146   0.000000
##  -0.207000   0.059698   -3.467   0.000533
## 2020.342936   0.367600 5496.040   0.000000
## ---
## Mean squared error:  30.862113 , RMSE:  5.555368
## Multiple R-squared: 0.145118 ,             Total iterations: 0
------------

------ Social Sciences ------

Note: the last rows are the information for Intercept
## -------------------------------------------------
##   Estimate   |   Std.Error | t Values  |  P-value
##  -0.437422   0.093563   -4.675   0.000004
##  -0.104549   0.146459   -0.714   0.475750
## 2019.182625   0.764850 2639.973   0.000000
## ---
## Mean squared error:  30.685713 , RMSE:  5.539469
## Multiple R-squared: 0.118772 ,             Total iterations: 0
------------

------ Health Sciences ------

Note: the last rows are the information for Intercept
## -------------------------------------------------
##   Estimate   |   Std.Error | t Values  |  P-value
##  -0.460876   0.019674  -23.425   0.000000
##  -0.218675   0.037611   -5.814   0.000000
## 2019.076458   0.231406 8725.260   0.000000
## ---
## Mean squared error:  30.039405 , RMSE:  5.480822
## Multiple R-squared: 0.144584 ,             Total iterations: 0
------------

------ Life Sciences ------

Note: the last rows are the information for Intercept
## -------------------------------------------------
##   Estimate   |   Std.Error | t Values  |  P-value
##  -0.604957   0.026519  -22.812   0.000000
##  -0.056843   0.046915   -1.212   0.225716
## 2019.490201   0.276602 7301.067   0.000000
## ---
## Mean squared error:  27.654316 , RMSE:  5.258737
## Multiple R-squared: 0.175747 ,             Total iterations: 0
------------

***Institution***.

-   We will summarize the number of affiliation ids present in BTS
    publications by subject area and visualize these results across
    time. These visualizations will be presented separately for each of
    the four subject areas.

+----------------------+
|count(affiliation_ids)|
+----------------------+
|                 35114|
+----------------------+

inst time 

***Education***.

We will summarize the general education categories of individuals at the time of publication, along with a summary for change over time.

    Figure out how messy this is for text processing requirements
    For each publication, plot of proportion of doctorates across time - if the number is going down, we are involving more diverse types of people (assuming that doctorates are "normal" academics/researchers)
    We will only perform this analysis if the proportion of information avaliable is over 50%.

+-----------+------+
|    degrees| count|
+-----------+------+
|       null|656440|
|         MD|  8190|
|        PhD|  3879|
|    MD, PhD|  1267|
|       M.D.|  1002|
|        Dr.|   490|
|        MSc|   461|
|        MPH|   368|
| Prof., PhD|   349|
|      Ph.D.|   348|
|         MS|   330|
|     MD PhD|   285|
|        MD.|   279|
|   Prof. MD|   266|
|  Prof. PhD|   239|
|         BS|   232|
|       Prof|   220|
|         BA|   196|
|M.D., Ph.D.|   191|
|    MD, MPH|   158|
+-----------+------+

***Types of Publications***.

-   We will summarize the coded types of publications for individuals.

pub_type versus normal_pub_type

***Publication Metrics***.


    We will report descriptive statistics on the total number of publications and h-index for individuals overall.
        Do this for each unique person and report averages
        Do this for each publication and create an average for each publication
    Next, we will use the same analyses described in the career length section to analyze trends over time. An increasing slope over time indicates that individuals who are publishing more are more represented in BTS over time (i.e., increasing numbers of scholars with higher publication rates), while a negative slope indicates more researchers with less publications.
    A positive slope for standard deviation indicates increasing variance over time (i.e., more diversity in the individual publication rates), while a negative slope would indicate less diversity in researchers over time. While publication rates do not represent value as a researcher, they are often used in hiring and promotion decisions, and we will use this variable as a proxy to gauge the diversity in scholars represented in big teams.
    We will separate these by each of the four subject areas.


	avg_pub_count	std_pub_count
0	4.451816	6.901369

	avg(avg_pub_count AS mean_of_avg_pub_count)	stddev_samp(avg_pub_count AS std_of_avg_pub_count)	avg(std_pub_count AS mean_of_std_pub_count)	stddev_samp(std_pub_count AS std_of_std_pub_count)
0	7.581413	5.797233	7.140015	5.10383

	avg_HIndex	std_HIndex	med_HIndex
0	14.242142	43.798203	2.0

	avg_of_avg_HIndex	std_of_avg_HIndex	avg_of_std_HIndex	std_of_std_HIndex	med_of_med_HIndex
0	28.136255	38.013819	36.430509	46.474619	5.0

------ Physical Sciences ------

Note: the last rows are the information for Intercept
## -------------------------------------------------
##   Estimate   |   Std.Error | t Values  |  P-value
##  -0.004420   0.022715   -0.195   0.845717
##  -0.105746   0.034058   -3.105   0.001922
## 2015.347578   0.195556 10305.717   0.000000
## ---
## Mean squared error:  35.756076 , RMSE:  5.979638
## Multiple R-squared: 0.009554 ,             Total iterations: 0
------------

------ Social Sciences ------

Note: the last rows are the information for Intercept
## -------------------------------------------------
##   Estimate   |   Std.Error | t Values  |  P-value
##  -0.335536   0.179536   -1.869   0.062389
##   0.130796   0.186924    0.700   0.484517
## 2016.658826   0.487148 4139.727   0.000000
## ---
## Mean squared error:  34.070868 , RMSE:  5.837026
## Multiple R-squared: 0.021558 ,             Total iterations: 0
------------

------ Health Sciences ------

Note: the last rows are the information for Intercept
## -------------------------------------------------
##   Estimate   |   Std.Error | t Values  |  P-value
##  -0.235551   0.028158   -8.365   0.000000
##  -0.006692   0.026612   -0.251   0.801476
## 2014.979175   0.119976 16794.893   0.000000
## ---
## Mean squared error:  33.860172 , RMSE:  5.818949
## Multiple R-squared: 0.035782 ,             Total iterations: 0
------------

------ Life Sciences ------

Note: the last rows are the information for Intercept
## -------------------------------------------------
##   Estimate   |   Std.Error | t Values  |  P-value
##  -0.430599   0.037807  -11.389   0.000000
##   0.133215   0.034255    3.889   0.000102
## 2016.008237   0.147870 13633.624   0.000000
## ---
## Mean squared error:  31.736306 , RMSE:  5.633499
## Multiple R-squared: 0.054081 ,             Total iterations: 0
------------

***Geopolitical Regions***.

-   We will present visualizations of the country information listed for
    authors, and we will discuss the areas of world in which authors
    generally come from, as well as the lowest representation of
    authors.
    
```{r geo-map}
# serbia has changed codes
DF$geo_country$affiliation_tag_country <- toupper(DF$geo_country$affiliation_tag_country)
DF$geo_country <- subset(DF$geo_country, affiliation_tag_country != "NONE")
DF$geo_country$affiliation_tag_country[DF$geo_country$affiliation_tag_country == "SCG"] <- "SRB"

DF$geo_country <- DF$geo_country %>% 
  group_by(affiliation_tag_country) %>% 
  summarize(count = sum(count))

# convert country code to region code
# this will warn you about the ones that have multiple countries 
# create a world map 
world_map <- map_data(map = "world")
world_map$orig_region <- world_map$region
world_map$region <- iso.alpha(world_map$region, n = 3)
world_map <- subset(world_map, region != "ATA")

# make a map on a continuous scale
ggplot(DF$geo_country) +
  geom_map(aes(map_id = affiliation_tag_country, fill = count), map = world_map) +
  geom_polygon(data = world_map, 
               aes(x = long, y = lat, group = group), 
               colour = 'black', fill = NA) + 
  theme_void() + 
  scale_fill_distiller(name = "Sample Size",
                       palette = "Greys",
                       direction = 1,
                       na.value = "white") 

ggsave("figure/continuous_country.png")
  
# maybe try binning
DF$geo_country$count_binned <- if_else(
  DF$geo_country$count >= 10000, "10,000+", 
  if_else(
    DF$geo_country$count < 10000 & DF$geo_country$count >= 5000, "5,000-9,999",
    if_else(
      DF$geo_country$count < 5000 & DF$geo_country$count >= 1000, "1,000-4,999",
      if_else(
        DF$geo_country$count < 1000 & DF$geo_country$count >= 100, "100-999",
        "< 100"
      )
    )
  )
)

DF$geo_country$count_binned <- factor(DF$geo_country$count_binned, 
                                   levels = unique(DF$geo_country$count_binned))

# map of binned data 
bin_country <- ggplot(DF$geo_country) +
  geom_map(aes(map_id = affiliation_tag_country, fill = count_binned), map = world_map) +
  geom_polygon(data = world_map, 
               aes(x = long, y = lat, group = group), 
               colour = 'black', fill = NA) + 
  theme_void() + 
  scale_fill_manual(name = "Sample Size",
                    values = c( "black", "#323232", "#646464","#969696","#c8c8c8")) 

bin_country

ggsave("figure/binned_country.png", bin_country)

# tree map
DF$geo_country$un_region_sub <- countrycode(
  sourcevar = DF$geo_country$affiliation_tag_country,
  origin = 'iso3c', 
  destination = 'un.regionsub.name'
)

DF$geo_country$un_region <- countrycode(
  sourcevar = DF$geo_country$affiliation_tag_country,
  origin = 'iso3c', 
  destination = 'un.region.name'
)

DF$geo_country$un_region[DF$geo_country$affiliation_tag_country == "TWN"] <- "Asia"
DF$geo_country$un_region_sub[DF$geo_country$affiliation_tag_country == "TWN"] <- "Eastern Asia"

DF$geo_country <- DF$geo_country %>% 
  na.omit()

tree <- ggplot(DF$geo_country, aes(area = count, fill = count_binned,
               label = affiliation_tag_country, subgroup = un_region_sub)) +
  geom_treemap() +
  geom_treemap_subgroup_border(colour = "white", size = 5) +
  # geom_treemap_subgroup_text(place = "top", grow = TRUE,
  #                            alpha = 0.25, colour = "black",
  #                            fontface = "italic") +
  geom_treemap_text(colour = "white", place = "centre",
                    size = 15, grow = FALSE) +  
  scale_fill_manual(name = "Sample Size",
                    values = c("#c8c8c8", "#969696", "#646464", "#323232", "black")) 
  # scale_fill_gradient(name = "Sample Size",
  #                     low = "#c8c8c8", 
  #                     high = "#323232") 

tree 

ggsave("figure/treemap.png", tree)
```

-   To understand the change in representation diversity, we will
    summarize the total number of geopolitical regions for each paper.
    Using a linear model, we will examine if the number of regions
    present is predicted by the year of publication. Increasing
    diversity would be represented by a positive slope, while decreasing
    diversity would be represented by a negative slope.

```{r}
label <- c("Physical", "Social", "Health", "Life")
b_values <- c(-0.061001, -0.077040, -0.017775, -0.014946)
se_values <- c(0.022958, 0.058153, 0.009794, 0.010485)
r2_values <- c(0.002357, 0.004491, 0.000434, 0.000434)
sample_size <- 13000

r2_low <- 1:length(r2_values)
r2_high <- 1:length(r2_values)
for (i in 1:length(r2_values)){
  temp <- ci.R2(R2 = r2_values[i], 1, sample_size)
  r2_low[i] <- temp$Lower.Conf.Limit.R2
  r2_high[i] <- temp$Upper.Conf.Limit.R2
}

graph_data <- data.frame(
  "label" = label,
  "estimate" = b_values,
  "type" = "Coefficient",
  "low" = b_values - qt(.025, sample_size, lower.tail = F)*se_values,
  "high" = b_values + qt(.025, sample_size, lower.tail = F)*se_values) %>% 
  bind_rows(
    data.frame(  
      "label" = label, 
      "estimate" = r2_values,
      "type" = "Effect Size",
      "low" = r2_low,
      "high" = r2_high)
  )

ggplot(graph_data, aes(label, estimate)) + 
  geom_point() +
  geom_pointrange(aes(ymin = low, ymax = high)) +
  theme_classic() + 
  facet_wrap(~type) + 
  geom_hline(yintercept = 0) + 
  coord_flip() + 
  xlab("Subject Area") + 
  ylab("")
```
   
    
total number of unique GP for each publication 
using year to predict GP 
positive slope means that as year goes up number of GP goes up 
negative slope means that as year goes up number of GP goes down 
forest plot of the effects + confidence interval 
    
------ Physical Sciences ------

Note: the last rows are the information for Intercept
## -------------------------------------------------
##   Estimate   |   Std.Error | t Values  |  P-value
##  -0.061001   0.022958   -2.657   0.007923
## 130.518393  46.247823    2.822   0.004802
## ---
## Mean squared error:  56.853041 , RMSE:  7.540096
## Multiple R-squared: 0.002357 ,             Total iterations: 0
------------

------ Social Sciences ------

Note: the last rows are the information for Intercept
## -------------------------------------------------
##   Estimate   |   Std.Error | t Values  |  P-value
##  -0.077040   0.058153   -1.325   0.186023
## 160.766462 117.214988    1.372   0.170993
## ---
## Mean squared error:  45.807761 , RMSE:  6.768143
## Multiple R-squared: 0.004491 ,             Total iterations: 0
------------

------ Health Sciences ------

Note: the last rows are the information for Intercept
## -------------------------------------------------
##   Estimate   |   Std.Error | t Values  |  P-value
##  -0.017775   0.009794   -1.815   0.069578
##  40.118948  19.718323    2.035   0.041926
## ---
## Mean squared error:  25.532574 , RMSE:  5.052977
## Multiple R-squared: 0.000434 ,             Total iterations: 0
------------

------ Life Sciences ------

Note: the last rows are the information for Intercept
## -------------------------------------------------
##   Estimate   |   Std.Error | t Values  |  P-value
##  -0.014946   0.010485   -1.425   0.154081
##  34.499812  21.117788    1.634   0.102392
## ---
## Mean squared error:  17.279398 , RMSE:  4.156850
## Multiple R-squared: 0.000434 ,             Total iterations: 0
------------

-   Last, we will examine the differences in representation for
    corresponding author sets versus all other authors. For papers with
    10 to 49 authors, we will use the three first authors and the last
    author to compare against other authors. For 50 to 99 authors, five
    first authors plus last will be used, and for all papers with more
    than 100 authors, we will use ten first authors and the last author.
    We will calculate the frequencies of each of the UN Sub-Regions for
    first authors versus other authors, converting these values to
    proportions. Given the expected small sample sizes of these
    contingency tables, we will group together titles based on the year
    of publication (assuming at least 5 publications per year, these may
    be binned by 5-year or smaller increments to increase sample size).
    For each grouping, we will calculate the effect size of the
    differences in frequencies comparing first authors to all other
    authors. Since this data is categorical, we will use Cramer's V to
    represent the effect size. If the effect size includes zero in its
    confidence interval, this result will imply that first and all other
    authors represent the same pattern of UN Sub-Region diversity. Any
    confidence interval that does include zero represents a difference
    in diversity. We will report these values and discuss what regions
    of the world are represented when effect sizes indicate a difference
    from zero using standardized residuals.
    
    ## fix the stupid CIs
    
    
```{r small-effects}
DF$small_first_gp <- DF$small_first_gp %>% 
  filter(aff_un != "other") %>% 
  pivot_wider(id_cols = Year, 
              names_from = aff_un, 
              values_from = count,
              values_fill = 0)

DF$small_other_gp <- DF$small_other_gp %>% 
  filter(aff_un != "other") %>% 
  pivot_wider(id_cols = Year, 
              names_from = aff_un, 
              values_from = count,
              values_fill = 0) %>% 
  select(colnames(DF$small_first_gp))

small_effect <- data.frame(
  year = 1:length(unique(DF$small_first_gp$Year)),
  v = 1:length(unique(DF$small_first_gp$Year)),
  low = 1:length(unique(DF$small_first_gp$Year)),
  high = 1:length(unique(DF$small_first_gp$Year))
)
i <- 1
for (year in unique(DF$small_first_gp$Year)){
  temp_table <- DF$small_first_gp %>% filter(Year == year) %>% select(-Year) %>% 
    bind_rows(DF$small_other_gp %>% filter(Year == year) %>% select(-Year))
  
  col_total <- colSums(temp_table)
  temp_table <- temp_table %>% 
    select(names(col_total)[col_total > 0])
  temp <- suppressWarnings(chisq.test(as.matrix(temp_table)))
  
  tryCatch(mote_temp <- v.chi.sq(x2 = temp$statistic, n = sum(temp_table), 
                        r = nrow(temp_table), c = ncol(temp_table), 
                        a = .05), 
       warning = function(w) { 
         mote_temp <<- v.chi.sq(x2 = temp$statistic, n = sum(temp_table), 
                        r = nrow(temp_table), c = ncol(temp_table), 
                        a = .05)
         mote_temp$vlow <<- 0
  }
  )
  
  small_effect$year[i] <- year
  small_effect$v[i] <- mote_temp$v
  small_effect$low[i] <- mote_temp$vlow
  small_effect$high[i] <- mote_temp$vhigh
  small_effect$people[i] <- mote_temp$n
  i <- i + 1
}

small_effect$high[is.na(small_effect$high)] <- 0
small_effect <- 
  small_effect %>% 
  filter(v != Inf)

small_dot <- ggplot(small_effect, aes(year,v)) + 
  geom_point(aes(size = people)) + 
  theme_classic() + 
  geom_pointrange(aes(ymin = low, ymax = high)) + 
  xlab("Year") + 
  ylab("Effect Size") + 
  scale_size_continuous(name = "Num Authors")

DF_decade <- DF$small_first_gp %>% 
  mutate(who = "First") %>% 
  bind_rows(
    DF$small_other_gp %>% 
      mutate(who = "Other")
  ) %>% 
  mutate(Decade = ifelse(Year < 1990, "1980s", 
                         ifelse(Year < 2000, "1990s", 
                                ifelse(Year < 2010, "2000s", 
                                       ifelse(Year < 2020, "2010s", "2020s"))))) %>% 
  group_by(who, Decade) %>% 
  summarize_all(sum) %>% 
  pivot_longer(cols = `Western Europe`:Mirconesia,
               names_to = "Country", 
               values_to = "Count")

# North America, Africa (combine), NWS Europe, Eastern Asia, Latin America, Rest of Europe, Rest of Asia, Everything Else 

DF_decade$Country_2 <- DF_decade$Country
DF_decade$Country_2 <- gsub(".*Africa.*", "Africa", DF_decade$Country_2)
DF_decade$Country_2 <- gsub("Northern Europe|Southern Europe|Western Europe", "NWS Europe", DF_decade$Country_2)
DF_decade$Country_2 <- gsub("South-Eastern Europe|Eastern Europe", "ESE Europe", DF_decade$Country_2)
DF_decade$Country_2 <- gsub("Central Asia|South-Eastern Asia|Southern Asia|Western Asia", "Asia", DF_decade$Country_2)
DF_decade$Country_2 <- gsub("Melanesia|Mirconesia|New zealand and Australia|Polynesia", "Other", DF_decade$Country_2)

DF_decade_sm <- DF_decade %>% 
  group_by(Country_2, Decade, who) %>% 
  summarize(Count = sum(Count), .groups = "keep")

small_author <- ggplot(DF_decade_sm, aes(who, Count, fill = Country_2)) + 
    geom_bar(position="fill", stat="identity", color = "black") + 
  theme_classic() + 
  facet_grid(~Decade) + 
  xlab("Author Type") + 
  ylab("Percent of Authors") + 
  scale_fill_brewer(name = "Region", palette = "Spectral")
```

```{r medium-effects}
DF$medium_first_gp <- DF$medium_first_gp %>% 
  filter(aff_un != "other") %>% 
  pivot_wider(id_cols = Year, 
              names_from = aff_un, 
              values_from = count,
              values_fill = 0)

DF$medium_other_gp <- DF$medium_other_gp %>% 
  filter(aff_un != "other") %>% 
  pivot_wider(id_cols = Year, 
              names_from = aff_un, 
              values_from = count,
              values_fill = 0) %>% 
  select(colnames(DF$medium_first_gp))

medium_effect <- data.frame(
  year = 1:length(unique(DF$medium_first_gp$Year)),
  v = 1:length(unique(DF$medium_first_gp$Year)),
  low = 1:length(unique(DF$medium_first_gp$Year)),
  high = 1:length(unique(DF$medium_first_gp$Year))
)
i <- 1
for (year in unique(DF$medium_first_gp$Year)){
  temp_table <- DF$medium_first_gp %>% filter(Year == year) %>% select(-Year) %>% 
    bind_rows(DF$medium_other_gp %>% filter(Year == year) %>% select(-Year))
  
  col_total <- colSums(temp_table)
  temp_table <- temp_table %>% 
    select(names(col_total)[col_total > 0])
  temp <- suppressWarnings(chisq.test(as.matrix(temp_table)))
  tryCatch(mote_temp <- v.chi.sq(x2 = temp$statistic, n = sum(temp_table), 
                        r = nrow(temp_table), c = ncol(temp_table), 
                        a = .05), 
       warning = function(w) { 
         mote_temp <<- v.chi.sq(x2 = temp$statistic, n = sum(temp_table), 
                        r = nrow(temp_table), c = ncol(temp_table), 
                        a = .05)
         mote_temp$vlow <<- 0
  }
  )
  medium_effect$year[i] <- year
  medium_effect$v[i] <- mote_temp$v
  medium_effect$low[i] <- mote_temp$vlow
  medium_effect$high[i] <- mote_temp$vhigh
  medium_effect$people[i] <- mote_temp$n
  i <- i + 1
}

medium_effect$high[is.na(medium_effect$high)] <- 0
medium_effect <- 
  medium_effect %>% 
  filter(v != Inf)

medium_dot <- ggplot(medium_effect, aes(year,v)) + 
  geom_point(aes(size = people)) + 
  theme_classic() + 
  geom_pointrange(aes(ymin = low, ymax = high)) + 
  xlab("Year") + 
  ylab("Effect Size") + 
  scale_size_continuous(name = "Num Authors")

DF_decade <- DF$medium_first_gp %>% 
  mutate(who = "First") %>% 
  bind_rows(
    DF$medium_other_gp %>% 
      mutate(who = "Other")
  ) %>% 
  mutate(Decade = ifelse(Year < 1990, "1980s", 
                         ifelse(Year < 2000, "1990s", 
                                ifelse(Year < 2010, "2000s", 
                                       ifelse(Year < 2020, "2010s", "2020s"))))) %>% 
  group_by(who, Decade) %>% 
  summarize_all(sum) %>% 
  pivot_longer(cols = `Western Europe`:Melanesia, 
               #### check this later ####
               names_to = "Country", 
               values_to = "Count")

# North America, Africa (combine), NWS Europe, Eastern Asia, Latin America, Rest of Europe, Rest of Asia, Everything Else 

DF_decade$Country_2 <- DF_decade$Country
DF_decade$Country_2 <- gsub(".*Africa.*", "Africa", DF_decade$Country_2)
DF_decade$Country_2 <- gsub("Northern Europe|Southern Europe|Western Europe", "NWS Europe", DF_decade$Country_2)
DF_decade$Country_2 <- gsub("South-Eastern Europe|Eastern Europe", "ESE Europe", DF_decade$Country_2)
DF_decade$Country_2 <- gsub("Central Asia|South-Eastern Asia|Southern Asia|Western Asia", "Asia", DF_decade$Country_2)
DF_decade$Country_2 <- gsub("Melanesia|Mirconesia|New zealand and Australia|Polynesia", "Other", DF_decade$Country_2)

DF_decade_sm <- DF_decade %>% 
  group_by(Country_2, Decade, who) %>% 
  summarize(Count = sum(Count), .groups = "keep")

medium_author <- ggplot(DF_decade_sm, aes(who, Count, fill = Country_2)) + 
    geom_bar(position="fill", stat="identity", color = "black") + 
  theme_classic() + 
  facet_grid(~Decade) + 
  xlab("Author Type") + 
  ylab("Percent of Authors") + 
  scale_fill_brewer(name = "Region", palette = "Spectral")
```

```{r large-effects}
DF$large_first_gp <- DF$large_first_gp %>% 
  filter(aff_un != "other") %>% 
  pivot_wider(id_cols = Year, 
              names_from = aff_un, 
              values_from = count,
              values_fill = 0)

DF$large_other_gp <- DF$large_other_gp %>% 
  filter(aff_un != "other") %>% 
  pivot_wider(id_cols = Year, 
              names_from = aff_un, 
              values_from = count,
              values_fill = 0) %>% 
  select(colnames(DF$large_first_gp))

large_effect <- data.frame(
  year = 1:length(unique(DF$large_first_gp$Year)),
  v = 1:length(unique(DF$large_first_gp$Year)),
  low = 1:length(unique(DF$large_first_gp$Year)),
  high = 1:length(unique(DF$large_first_gp$Year))
)
i <- 1
for (year in unique(DF$large_first_gp$Year)){
  temp_table <- DF$large_first_gp %>% filter(Year == year) %>% select(-Year) %>% 
    bind_rows(DF$large_other_gp %>% filter(Year == year) %>% select(-Year))
  
  col_total <- colSums(temp_table)
  temp_table <- temp_table %>% 
    select(names(col_total)[col_total > 0])
  temp <- suppressWarnings(chisq.test(as.matrix(temp_table)))
  tryCatch(mote_temp <- v.chi.sq(x2 = temp$statistic, n = sum(temp_table), 
                        r = nrow(temp_table), c = ncol(temp_table), 
                        a = .05), 
       warning = function(w) { 
         mote_temp <<- v.chi.sq(x2 = temp$statistic, n = sum(temp_table), 
                        r = nrow(temp_table), c = ncol(temp_table), 
                        a = .05)
         mote_temp$vlow <<- 0
  }
  )
  large_effect$year[i] <- year
  large_effect$v[i] <- mote_temp$v
  large_effect$low[i] <- mote_temp$vlow
  large_effect$high[i] <- mote_temp$vhigh
  large_effect$people[i] <- mote_temp$n
  i <- i + 1
}

large_effect$high[is.na(large_effect$high)] <- 0
large_effect <- 
  large_effect %>% 
  filter(v != Inf)

large_dot <- ggplot(large_effect, aes(year,v)) + 
  geom_point(aes(size = people)) + 
  theme_classic() + 
  geom_pointrange(aes(ymin = low, ymax = high)) + 
  xlab("Year") + 
  ylab("Effect Size") + 
  scale_size_continuous(name = "Num Authors")

DF_decade <- DF$large_first_gp %>% 
  mutate(who = "First") %>% 
  bind_rows(
    DF$large_other_gp %>% 
      mutate(who = "Other")
  ) %>% 
  mutate(Decade = ifelse(Year < 1990, "1980s", 
                         ifelse(Year < 2000, "1990s", 
                                ifelse(Year < 2010, "2000s", 
                                       ifelse(Year < 2020, "2010s", "2020s"))))) %>% 
  group_by(who, Decade) %>% 
  summarize_all(sum) %>% 
  pivot_longer(cols = `Western Europe`:`Central Asia`, 
               #### check this later ####
               names_to = "Country", 
               values_to = "Count")

# North America, Africa (combine), NWS Europe, Eastern Asia, Latin America, Rest of Europe, Rest of Asia, Everything Else 

DF_decade$Country_2 <- DF_decade$Country
DF_decade$Country_2 <- gsub(".*Africa.*", "Africa", DF_decade$Country_2)
DF_decade$Country_2 <- gsub("Northern Europe|Southern Europe|Western Europe", "NWS Europe", DF_decade$Country_2)
DF_decade$Country_2 <- gsub("South-Eastern Europe|Eastern Europe", "ESE Europe", DF_decade$Country_2)
DF_decade$Country_2 <- gsub("Central Asia|South-Eastern Asia|Southern Asia|Western Asia", "Asia", DF_decade$Country_2)
DF_decade$Country_2 <- gsub("Melanesia|Mirconesia|New zealand and Australia|Polynesia", "Other", DF_decade$Country_2)

DF_decade_sm <- DF_decade %>% 
  group_by(Country_2, Decade, who) %>% 
  summarize(Count = sum(Count), .groups = "keep")

large_author <- ggplot(DF_decade_sm, aes(who, Count, fill = Country_2)) + 
    geom_bar(position="fill", stat="identity", color = "black") + 
  theme_classic() + 
  facet_grid(~Decade) + 
  xlab("Author Type") + 
  ylab("Percent of Authors") + 
  scale_fill_brewer(name = "Region", palette = "Spectral")
```

```{r final-graphs}
small_author + #theme(legend.position = "none") + 
medium_author + #theme(legend.position = "none") + 
large_author + #theme(legend.position = "none") + 
guide_area() + 
plot_layout(
  ncol = 2,
  nrow = 2, 
  guides = "collect")

ggsave("figure/author_country.png", width = 10, height = 7, 
       units = "in")

small_dot + 
  theme(legend.position = "none") + 
  coord_cartesian(ylim = c(0,1)) +
medium_dot + 
  theme(legend.position = "none") + 
  coord_cartesian(ylim = c(0,1)) +
large_dot + 
  theme(legend.position = "none") + 
  coord_cartesian(ylim = c(0,1)) +
guide_area() + 
plot_layout(
  ncol = 2,
  nrow = 2, 
  guides = "collect")

ggsave("figure/effect_country.png", width = 10, height = 7, 
       units = "in")
```

end up with a list of effect sizes by year by small medium large 
x axis is year
y axis is the effect size and the confidence interval 
if diversity is increasing then the patterns would be more similar (effect size of zero)
if diversity is not increasing then the patterns would be different (effect size does not include zero)

who is not represented in the "corresponding" spots - proportion chart by decades stacked bar chart of the decades 

\newpage

# References

```{=tex}
\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}
```

::: {#refs custom-style="Bibliography"}
:::

```{=tex}
\endgroup
```
